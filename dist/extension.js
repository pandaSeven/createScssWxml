(()=>{"use strict";var e={669:function(e,t,n){var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,o){function c(e){try{l(s.next(e))}catch(e){o(e)}}function i(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(496),o=n(453),c=n(776);t.activate=function(e){console.log("扩展激活"),o.updateConfig();let t=null;r.workspace.onDidChangeConfiguration((()=>{if(o.updateConfig(),"onCommand"===c.default.config.createScssWxmlConf.excuteMode){if(!t)return;t.dispose()}else t=o.excuteWhenSave()})),"onSave&onCommand"===c.default.config.createScssWxmlConf.excuteMode&&(t=o.excuteWhenSave()),e.subscriptions.push(r.commands.registerTextEditorCommand("extension.createScssWxml",(e=>s(this,void 0,void 0,(function*(){if(console.log("createScssWxml 执行命令启动"),!e)return console.log("no textEditor");const t=e.document;if(t.isDirty){let e=!1;try{e=yield extension.createScssWxml.save()}catch(e){console.log("save error:",e)}if(!e)return r.window.showInformationMessage("请先保存当前文件")}if("wxml"!==t.languageId)return r.window.showInformationMessage("当前不是wxml文件");const n=o.generateProcess(t);o.updateScssFile(t.uri.fsPath,n,(()=>{e.edit((e=>{e.replace(new r.Range(new r.Position(0,0),new r.Position(t.lineCount+1,0)),n),setTimeout((()=>{t.save().then((e=>{console.log("保存结果：",e)}))}),0)}))}))})))))},t.deactivate=function(){console.log("扩展释放")}},770:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=n(418),r=n(632);t.default=(e,t)=>{let n="",o=null,c="";const i=e.match(/<view[^>]*>([\s\S]*)<\/view>/);i&&(c=i[1].trim()),console.log(i,c),"string"==typeof t?n=t:(o=e.match(/<style[^>]*>([\s\S]*)<\/style>/),o&&(n=o[1].trim()));const l=s.default("<wrapper>"+c+"</wrapper>"),a=r.scssStr2Ast("wrapper {"+n+"}");r.resetScss(l,a);const u=r.scssAstObj2Str(a.children[0]).trim().slice(9,-1).trimLeft();let d="";if("string"==typeof t)d=u;else if(o){const t=e.match(/([\s\S]*)(<style[^>]*>)([\s\S]*)(<\/style>\s*)/);t&&(d=t[1]+t[2]+"\n"+u.trimRight()+"\n"+t[4])}else d=e+`\n<style lang="scss" scoped>${"\n"+u.trimRight()+"\n"}</style>\n`;return d}},418:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=/((:|v-bind:)?[\w$\-]+)|(?<word>["'"]){1}[\s\S]*?\k<word>/g,s=/(?<=('|"))[\w\-$]+(?=\1)/g,r=["wrapper","a","abbr","acronym","address","applet","article","aside","audio","b","basefont","bdi","bdo","big","blockquote","button","canvas","caption","center","cite","code","colgroup","command","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","i","iframe","ins","kbd","label","legend","li","main","map","mark","menu","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","small","span","strike","strong","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","tt","u","ul","var","video","view"],o=["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr","image"];const c=[{name:"class",tag:"."},{name:"id",tag:"#"}];function i(e){if(!e||"tag"!==e.type)return null;if((e.name.match(/^[A-Z]/)||!r.concat(o).includes(e.name))&&!e.attrs.class&&!e.attrs.id)return e.children.length?e.children.map((e=>i(e))).reduce(((e,t)=>t?e.concat(t):e),[]):null;const t=function(e){const t={selectorNames:[],children:[]};if(c.forEach((n=>{["attrs","bindAttrs"].forEach((r=>{e[r][n.name]&&(t.selectorNames=t.selectorNames.concat(function(e,t,n){const r=[];let o=n?e.match(s):e.split(/\s+/).filter((e=>e));return o&&o.forEach((e=>{r.push(t+e)})),r}(e[r][n.name],n.tag,"bindAttrs"===r)))}))})),0===t.selectorNames.length){if(e.voidElement&&!o.includes(e.name))return null;t.selectorNames.push(e.name)}return t}(e);if(e.children)for(let n=0;n<e.children.length;n++){let s=i(e.children[n]);s&&(t.children=t.children.concat(s))}return t}t.default=e=>i(function(e){if(!e)return[];let t=[],s=null,r=-1,c=[],i={};return e.replace(/<!--[\s\S]*?-->|<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,(e=>{if(-1!==e.indexOf("\x3c!--"))return"";const l="/"!==e.charAt(1);let a;return l&&(r++,s=function(e){let t,s=0,r="attrs";const c={type:"tag",name:"",voidElement:!1,attrs:{},bindAttrs:{},children:[]};return e.replace(n,(n=>(s%2?(t=n,0===n.indexOf(":")||0===n.indexOf("v-bind:")?(t=n.replace(/(:|v-bind:)/,""),r="bindAttrs"):r="attrs"):0===s?((o.includes(n)||"/"===e.charAt(e.length-2))&&(c.voidElement=!0),c.name=n):c[r][t]=n.replace(/^\s*["']|["']\s*$/g,""),s++,""))),c}(e),i[s.tagName]=s,0===r&&t.push(s),a=c[r-1],a&&a.children.push(s),c[r]=s),l&&!s.voidElement||r--,""})),console.log("result:",t),t}(e)[0])},632:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=n(776);function r(e){return e<=0?"\n":"\n"+" ".repeat(s.default.config.indenConf.tabSize).repeat(e)}function o(e,t=""){return e.selectorNames.startsWith("&")?e.parent?o(e.parent,e.selectorNames+t.replace("&","")):e.selectorNames+t:e.selectorNames+t.replace("&","")}function c(e,t=[]){for(let n=0;n<e.children.length;n++)e.children[n].selectorNames.forEach(((s,r)=>{t.push({rule:"",selectorNames:s,children:0===r?c(e.children[n]):[],rnInfo:{},isNew:!0})}));return t}const i=JSON.stringify({selectorNames:"",children:[],rule:"",rnInfo:{}}),l=new RegExp("^\\s*}|([^{}]|#{[^}]*})+;(?=[^{:]+?{)|([^{}]|#{[^}]*})+?(?=\\s*})|([^{]|(?<=#){)*{"),a=/^\s*\/\/[\s\S]*(?=\n)|^\s*\/\*[\s\S]*?\*\//;let u=null;const d=(e,t=JSON.parse(i))=>{if(!e.trim())return t;if(u=e.match(l),!u)return console.log("no mt"),null;let n=u[0];if(/[^#]{/.test(n)){e=e.slice(n.length);const s={selectorNames:"",children:[],rule:"",parent:t,isKeyRule:0===n.trim().indexOf("@"),rnInfo:{start:"",end:""}},r=n.match(a);r&&(s.comment=r[0],n=n.slice(s.comment.length));const o=n.match(/(\s*)([\s\S]*\S)(\s*){$/);return s.selectorNames=o[2],s.rnInfo.start=o[1],s.rnInfo.startAfter=o[3],t.children.push(s),d(e,s)}return/^\s*}$/.test(n)?(t.rnInfo.end=n.match(/^\s*/)[0],e=e.slice(n.length),d(e,t.parent)):(t.rule=(t.rule||"")+e.slice(0,n.length),e=e.slice(n.length),d(e,t))};t.scssStr2Ast=d;const f=(e,t=-1)=>{if(!e)return"";let n=(e.comment||"")+(e.isNew?r(t):e.rnInfo.start||"")+e.selectorNames+(e.isNew?" ":e.rnInfo.startAfter)+"{";if(e.rule&&(n+=e.rule||""),e.children.length){const s=(e=>{const t={},n=[];let s=e.length;for(let r=0;r<s;r++)t[e[r].selectorNames]?0!==e[r].children.length&&n.push(e[r]):(0===e[r].children.length&&(t[e[r].selectorNames]=!0),n.push(e[r]));return n})(e.children);s.forEach((e=>{n+=f(e,t+1)}))}return n+=(e.isNew?r(t):e.rnInfo.end||"")+"}",n};t.scssAstObj2Str=f;const m=(e,t,n=0)=>{if(!e)return;const s=e.selectorNames;for(let r=0;r<s.length;r++){const i=s[r],l=t.children.findIndex((e=>!e.hasMatch&&(i===e.selectorNames||e.selectorNames.startsWith("&")&&i===o(e))));if(-1===l)t.children=t.children.slice(0,n+r).concat({rule:"",selectorNames:i,children:0==r?c(e):[],rnInfo:{},hasMatch:!0,isNew:!0},t.children.slice(n+r));else{if(r>0)continue;t.children[l].hasMatch=!0;let n=null;e.children.forEach(((s,r)=>{n=t.children[l],n.isKeyRule||m(s,n,e.children.slice(0,r).reduce(((e,t)=>e+t.selectorNames.length),0))}))}}};t.resetScss=m},453:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=n(496),r=n(770),o=n(776),c=n(147),i=n(17);function l(e){let t="";try{t=c.readFileSync(i.resolve(e,o.default.config.createScssWxmlConf.scssFilePath)).toString()}catch(e){console.log("readScssFile Error:",e.toString())}return t}function a(e,t,n){return console.log("更新scss",e,t,n),t?o.default.config.createScssWxmlConf.scssFilePath?void c.writeFile(i.resolve(e,o.default.config.createScssWxmlConf.scssFilePath),t,(t=>{if(t)return s.window.showInformationMessage("写入scss错误："+t.toString());console.log("写入 scss文件成功",i.resolve(e,o.default.config.createScssWxmlConf.scssFilePath))})):n():console.log("empty scssStr")}function u(e){if("wxml"!==e.languageId)return console.log("not wxml",e.languageId),"";const t=e.getText();if(!t||!/<view[\s\S]*<\/view>/.test(t))return console.log("no activeText or no view",t.length),"";let n="";try{n=r.default(t,o.default.config.createScssWxmlConf.scssFilePath?l(e.uri.fsPath):void 0)}catch(e){console.log("getScssFile Error:",e)}return n}t.excuteWhenSave=function(){return s.workspace.onWillSaveTextDocument((e=>{const t=s.window.activeTextEditor;if(!t)return;const n=t.document;if(!n.isDirty)return console.log("not dirty");const r=u(n);a(n.uri.fsPath,r,(()=>{e.waitUntil(new Promise((e=>{t.edit((t=>{t.replace(new s.Range(new s.Position(0,0),new s.Position(n.lineCount+1,0)),r),e()}))})))}))}))},t.readScssFile=l,t.updateScssFile=a,t.generateProcess=u,t.updateConfig=function(){const e=s.workspace.getConfiguration();console.log("config update:",o.default.config.createScssWxmlConf),o.default.config.createScssWxmlConf=e.createScssWxml,"number"==typeof e.editor.tabSize&&(o.default.config.indenConf.tabSize=e.editor.tabSize)}},776:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={config:{createScssWxmlConf:{excuteMode:"",scssFilePath:""},indenConf:{tabSize:2}}}},496:e=>{e.exports=require("vscode")},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")}},t={},n=function n(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,n),o.exports}(669);module.exports=n})();
//# sourceMappingURL=extension.js.map